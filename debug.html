<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ†ã‚¹ãƒˆ</title>
    <style>
        body {
            font-family: monospace;
            background: #1a1a1a;
            color: #fff;
            padding: 20px;
        }
        .section {
            background: #2a2a2a;
            padding: 20px;
            margin: 20px 0;
            border-radius: 10px;
        }
        button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #45a049;
        }
        pre {
            background: #000;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
        }
        .error {
            color: #ff5555;
        }
        .success {
            color: #50fa7b;
        }
    </style>
</head>
<body>
    <h1>ğŸ” ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨ºæ–­ãƒ„ãƒ¼ãƒ«</h1>
    
    <div class="section">
        <h2>1. Supabaseæ¥ç¶šãƒ†ã‚¹ãƒˆ</h2>
        <button onclick="testConnection()">æ¥ç¶šãƒ†ã‚¹ãƒˆ</button>
        <pre id="connection-result">ã¾ã ãƒ†ã‚¹ãƒˆã—ã¦ã„ã¾ã›ã‚“</pre>
    </div>

    <div class="section">
        <h2>2. ãƒ†ãƒ¼ãƒ–ãƒ«ä¸€è¦§å–å¾—</h2>
        <p>â€» RLSãƒãƒªã‚·ãƒ¼ã§è¦‹ãˆã‚‹ãƒ†ãƒ¼ãƒ–ãƒ«ã®ã¿è¡¨ç¤ºã•ã‚Œã¾ã™</p>
        <button onclick="listTables()">ãƒ†ãƒ¼ãƒ–ãƒ«ç¢ºèª</button>
        <pre id="tables-result">ã¾ã ãƒ†ã‚¹ãƒˆã—ã¦ã„ã¾ã›ã‚“</pre>
    </div>

    <div class="section">
        <h2>3. å¤§ä¼šãƒ‡ãƒ¼ã‚¿ç¢ºèª</h2>
        <input type="text" id="tournament-id" value="kanren" style="padding: 8px; border-radius: 5px; margin-right: 10px;">
        <button onclick="checkTournament()">å¤§ä¼šç¢ºèª</button>
        <pre id="tournament-result">ã¾ã ãƒ†ã‚¹ãƒˆã—ã¦ã„ã¾ã›ã‚“</pre>
    </div>

    <div class="section">
        <h2>4. é¸æ‰‹ãƒ‡ãƒ¼ã‚¿ç¢ºèª</h2>
        <button onclick="checkPlayers()">é¸æ‰‹ç¢ºèª</button>
        <pre id="players-result">ã¾ã ãƒ†ã‚¹ãƒˆã—ã¦ã„ã¾ã›ã‚“</pre>
    </div>

    <div class="section">
        <h2>5. ãƒ†ã‚¹ãƒˆé¸æ‰‹ã‚’è¿½åŠ </h2>
        <input type="number" id="test-zekken" value="999" placeholder="ã‚¼ãƒƒã‚±ãƒ³ç•ªå·" style="padding: 8px; width: 150px; margin-right: 10px;">
        <input type="text" id="test-name" value="ãƒ†ã‚¹ãƒˆå¤ªéƒ" placeholder="åå‰" style="padding: 8px; width: 150px; margin-right: 10px;">
        <button onclick="addTestPlayer()">è¿½åŠ ãƒ†ã‚¹ãƒˆ</button>
        <pre id="add-result">ã¾ã ãƒ†ã‚¹ãƒˆã—ã¦ã„ã¾ã›ã‚“</pre>
    </div>

    <script type="module">
        import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/+esm'

        const supabaseUrl = 'https://pkjvdtvomqzcnfhkqven.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InBranZkdHZvbXF6Y25maGtxdmVuIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzkzMTMzNzcsImV4cCI6MjA1NDg4OTM3N30.eHosTnLVgetda3nWuv1Tlw_bgy5DhsB_mU7F4g5SX0U';
        const client = createClient(supabaseUrl, supabaseKey);

        window.client = client;

        window.testConnection = async function() {
            const result = document.getElementById('connection-result');
            result.innerHTML = 'æ¥ç¶šä¸­...';
            
            try {
                // ç°¡å˜ãªã‚¯ã‚¨ãƒªã§ãƒ†ã‚¹ãƒˆ
                const { data, error } = await client.from('tournaments').select('count', { count: 'exact', head: true });
                
                if (error) {
                    result.innerHTML = `<span class="error">âŒ ã‚¨ãƒ©ãƒ¼:</span>\n${JSON.stringify(error, null, 2)}`;
                } else {
                    result.innerHTML = `<span class="success">âœ… æ¥ç¶šæˆåŠŸï¼</span>\nSupabaseã«æ­£å¸¸ã«æ¥ç¶šã§ãã¾ã—ãŸ`;
                }
            } catch (err) {
                result.innerHTML = `<span class="error">âŒ ä¾‹å¤–:</span>\n${err.message}`;
            }
        }

        window.listTables = async function() {
            const result = document.getElementById('tables-result');
            result.innerHTML = 'ãƒ†ãƒ¼ãƒ–ãƒ«ç¢ºèªä¸­...';
            
            const tables = ['tournaments', 'players', 'catches'];
            const results = [];

            for (const table of tables) {
                try {
                    const { data, error } = await client.from(table).select('*').limit(1);
                    
                    if (error) {
                        results.push(`âŒ ${table}: ${error.message}`);
                    } else {
                        results.push(`âœ… ${table}: ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½`);
                    }
                } catch (err) {
                    results.push(`âŒ ${table}: ${err.message}`);
                }
            }

            result.innerHTML = results.join('\n');
        }

        window.checkTournament = async function() {
            const result = document.getElementById('tournament-result');
            const tournamentId = document.getElementById('tournament-id').value;
            
            result.innerHTML = 'ç¢ºèªä¸­...';
            
            try {
                const { data, error } = await client
                    .from('tournaments')
                    .select('*')
                    .eq('id', tournamentId)
                    .single();
                
                if (error) {
                    result.innerHTML = `<span class="error">âŒ ã‚¨ãƒ©ãƒ¼:</span>\n${JSON.stringify(error, null, 2)}`;
                } else if (!data) {
                    result.innerHTML = `<span class="error">âŒ å¤§ä¼šãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“</span>`;
                } else {
                    result.innerHTML = `<span class="success">âœ… å¤§ä¼šãŒè¦‹ã¤ã‹ã‚Šã¾ã—ãŸ:</span>\n${JSON.stringify(data, null, 2)}`;
                }
            } catch (err) {
                result.innerHTML = `<span class="error">âŒ ä¾‹å¤–:</span>\n${err.message}`;
            }
        }

        window.checkPlayers = async function() {
            const result = document.getElementById('players-result');
            const tournamentId = document.getElementById('tournament-id').value || 'kanren';
            
            result.innerHTML = 'ç¢ºèªä¸­...';
            
            try {
                const { data, error } = await client
                    .from('players')
                    .select('*')
                    .eq('tournament_id', tournamentId)
                    .order('zekken');
                
                if (error) {
                    result.innerHTML = `<span class="error">âŒ ã‚¨ãƒ©ãƒ¼:</span>\n${JSON.stringify(error, null, 2)}`;
                } else if (!data || data.length === 0) {
                    result.innerHTML = `<span class="error">âŒ é¸æ‰‹ãŒç™»éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“</span>`;
                } else {
                    result.innerHTML = `<span class="success">âœ… é¸æ‰‹ãƒ‡ãƒ¼ã‚¿ (${data.length}äºº):</span>\n${JSON.stringify(data, null, 2)}`;
                }
            } catch (err) {
                result.innerHTML = `<span class="error">âŒ ä¾‹å¤–:</span>\n${err.message}`;
            }
        }

        window.addTestPlayer = async function() {
            const result = document.getElementById('add-result');
            const tournamentId = document.getElementById('tournament-id').value || 'kanren';
            const zekken = parseInt(document.getElementById('test-zekken').value);
            const name = document.getElementById('test-name').value;
            
            result.innerHTML = 'è¿½åŠ ä¸­...';
            
            try {
                const { data, error } = await client
                    .from('players')
                    .insert({
                        tournament_id: tournamentId,
                        zekken: zekken,
                        name: name,
                        club: 'ãƒ†ã‚¹ãƒˆã‚¯ãƒ©ãƒ–'
                    })
                    .select();
                
                if (error) {
                    result.innerHTML = `<span class="error">âŒ ã‚¨ãƒ©ãƒ¼:</span>\n${JSON.stringify(error, null, 2)}`;
                } else {
                    result.innerHTML = `<span class="success">âœ… è¿½åŠ æˆåŠŸ:</span>\n${JSON.stringify(data, null, 2)}`;
                }
            } catch (err) {
                result.innerHTML = `<span class="error">âŒ ä¾‹å¤–:</span>\n${err.message}`;
            }
        }

        console.log('âœ… è¨ºæ–­ãƒ„ãƒ¼ãƒ«æº–å‚™å®Œäº†');
    </script>
</body>
</html>

import{createClient as q}from"https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/+esm";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))l(o);new MutationObserver(o=>{for(const i of o)if(i.type==="childList")for(const c of i.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&l(c)}).observe(document,{childList:!0,subtree:!0});function n(o){const i={};return o.integrity&&(i.integrity=o.integrity),o.referrerPolicy&&(i.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?i.credentials="include":o.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function l(o){if(o.ep)return;o.ep=!0;const i=n(o);fetch(o.href,i)}})();const D="https://pkjvdtvomqzcnfhkqven.supabase.co",H="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InBranZkdHZvbXF6Y25maGtxdmVuIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzA3NDU2MjYsImV4cCI6MjA4NjMyMTYyNn0.Wn-igVmMwRbmR9ph5uNC4_HdOdclEccqNQWimRP-C38",f=q(D,H);let y=0,a={},g=null,w=[],L=[],N=!0,_=null;console.log("ğŸ£ ã‚·ã‚¹ãƒ†ãƒ èµ·å‹•");document.addEventListener("DOMContentLoaded",async function(){const t=new URLSearchParams(window.location.search).get("id");t?await j(t):F()});function F(){document.getElementById("top-page").style.display="flex",document.getElementById("tournament-page").style.display="none",R()}window.enterTournament=function(){const e=document.getElementById("tournament-id-input").value.trim();if(!e){r("å¤§ä¼šIDã‚’å…¥åŠ›ã—ã¦ãã ã•ã„",!0);return}window.location.href=`?id=${e}`};async function R(){const{data:e,error:t}=await f.from("tournaments").select("id, name, created_at").order("created_at",{ascending:!1}).limit(10),n=document.getElementById("tournament-list");if(t){console.error("å¤§ä¼šä¸€è¦§èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:",t),n.innerHTML='<div style="color: #e74c3c;">èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ</div>';return}if(!e||e.length===0){n.innerHTML='<div style="opacity: 0.6;">ã¾ã å¤§ä¼šãŒã‚ã‚Šã¾ã›ã‚“</div>';return}n.innerHTML=e.map(l=>`
        <div style="background: rgba(255,255,255,0.1); padding: 12px; border-radius: 8px; margin-bottom: 8px; display: flex; justify-content: space-between; align-items: center;">
            <div>
                <div style="font-weight: bold; font-size: 16px;">${l.name}</div>
                <div style="font-size: 12px; opacity: 0.7;">ID: ${l.id}</div>
            </div>
            <button class="btn btn-primary" onclick="window.location.href='?id=${l.id}'" style="padding: 8px 15px; font-size: 14px;">å‚åŠ </button>
        </div>
    `).join("")}window.createTournament=async function(){const e=document.getElementById("new-tournament-id").value.trim(),t=document.getElementById("new-tournament-name").value.trim(),n=document.getElementById("new-tournament-admin-password").value.trim(),l=document.getElementById("new-tournament-staff-password").value.trim();if(!e||!t||!n){r("å¤§ä¼šIDã€å¤§ä¼šåã€ç®¡ç†è€…ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã¯å¿…é ˆã§ã™",!0);return}if(!/^[a-zA-Z0-9]+$/.test(e)){r("å¤§ä¼šIDã¯åŠè§’è‹±æ•°å­—ã®ã¿ã§å…¥åŠ›ã—ã¦ãã ã•ã„",!0);return}console.log("ğŸ†• å¤§ä¼šä½œæˆ:",{id:e,name:t});const{data:o,error:i}=await f.from("tournaments").insert({id:e,name:t,password:n,staff_password:l||null,rule_type:"limit_total_len",limit_count:0,sort1:"one_max_len",sort2:"one_max_weight",sort3:null}).select();if(i){console.error("å¤§ä¼šä½œæˆã‚¨ãƒ©ãƒ¼:",i),i.code==="23505"?r("ã“ã®å¤§ä¼šIDã¯æ—¢ã«ä½¿ç”¨ã•ã‚Œã¦ã„ã¾ã™",!0):r("å¤§ä¼šã®ä½œæˆã«å¤±æ•—ã—ã¾ã—ãŸ",!0);return}r("âœ… å¤§ä¼šã‚’ä½œæˆã—ã¾ã—ãŸï¼"),document.getElementById("new-tournament-id").value="",document.getElementById("new-tournament-name").value="",document.getElementById("new-tournament-admin-password").value="",document.getElementById("new-tournament-staff-password").value="",await R(),setTimeout(()=>{window.location.href=`?id=${e}`},1500)};async function j(e){g=e,console.log("ğŸ“‚ å¤§ä¼šID:",g);const{data:t,error:n}=await f.from("tournaments").select("*").eq("id",g).single();if(n||!t){console.error("å¤§ä¼šå–å¾—ã‚¨ãƒ©ãƒ¼:",n),alert("å¤§ä¼šãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“"),F();return}a=t,console.log("âœ… å¤§ä¼šæƒ…å ±å–å¾—:",a),console.log("ğŸ“‹ å¤§ä¼šãƒ«ãƒ¼ãƒ«:",a.rule_type),console.log("ğŸ“Š ãƒªãƒŸãƒƒãƒˆåŒ¹æ•°:",a.limit_count),console.log("ğŸ¯ å„ªå…ˆé †ä½1:",a.sort1),console.log("ğŸ¯ å„ªå…ˆé †ä½2:",a.sort2),console.log("ğŸ¯ å„ªå…ˆé †ä½3:",a.sort3),document.getElementById("tournament-name").textContent=a.name;const l=a.limit_count>0?`ãƒªãƒŸãƒƒãƒˆ${a.limit_count}åŒ¹`:"ç·åŠ›æˆ¦";document.getElementById("tournament-info").textContent=l,document.getElementById("top-page").style.display="none",document.getElementById("tournament-page").style.display="block",await E(),await k(),U()}function U(){_&&_.unsubscribe(),_=f.channel("tournament-updates").on("postgres_changes",{event:"*",schema:"public",table:"catches",filter:`tournament_id=eq.${g}`},()=>{N&&(console.log("âš¡ ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ›´æ–°"),k(),y>0&&b())}).subscribe(),console.log("ğŸ“¡ ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ è³¼èª­é–‹å§‹")}window.toggleRealtimeUpdate=function(){N=document.getElementById("realtime-toggle").checked;const e=document.getElementById("manual-refresh-btn");N?(e.style.display="none",r("âœ… ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ›´æ–°: ON"),console.log("ğŸ“¡ ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ›´æ–°: ON")):(e.style.display="inline-block",r("â¸ï¸ ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ›´æ–°: OFFï¼ˆæ‰‹å‹•æ›´æ–°ãƒ¢ãƒ¼ãƒ‰ï¼‰"),console.log("â¸ï¸ ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ›´æ–°: OFF"))};window.manualRefreshRanking=async function(){r("ğŸ”„ æ›´æ–°ä¸­..."),await k(),y>0&&await b(),r("âœ… æ›´æ–°ã—ã¾ã—ãŸ")};window.switchTab=function(e){document.querySelectorAll(".tab").forEach((n,l)=>{n.classList.remove("active"),(e==="ranking"&&l===0||e==="input"&&l===1||e==="settings"&&l===2)&&n.classList.add("active")}),document.querySelectorAll(".view").forEach(n=>{n.classList.remove("active")}),e==="ranking"?(document.getElementById("ranking-view").classList.add("active"),k()):e==="input"?(document.getElementById("input-view").classList.add("active"),y>0?(document.getElementById("login-box").style.display="none",document.getElementById("input-form").style.display="block",E(),b()):(document.getElementById("login-box").style.display="block",document.getElementById("input-form").style.display="none")):e==="settings"&&(document.getElementById("settings-view").classList.add("active"),y===2&&(document.getElementById("rule-settings-card").style.display="block",V()),y>0&&E().then(()=>z()))};window.login=function(){const e=document.getElementById("password-input").value;if(e===a.password)y=2,r("âœ… ç®¡ç†è€…ã¨ã—ã¦ãƒ­ã‚°ã‚¤ãƒ³"),A("ç®¡ç†è€…");else if(e===a.staff_password)y=1,r("âœ… é‹å–¶ã‚¹ã‚¿ãƒƒãƒ•ã¨ã—ã¦ãƒ­ã‚°ã‚¤ãƒ³"),A("é‹å–¶ã‚¹ã‚¿ãƒƒãƒ•");else{r("ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒé•ã„ã¾ã™",!0);return}console.log("ğŸ” ãƒ­ã‚°ã‚¤ãƒ³æˆåŠŸ AUTH_LEVEL:",y),document.getElementById("login-box").style.display="none",document.getElementById("input-form").style.display="block",E(),b()};window.logout=function(){J("ãƒ­ã‚°ã‚¢ã‚¦ãƒˆã—ã¾ã™ã‹ï¼Ÿ",()=>{y=0,_&&(_.unsubscribe(),_=null),r("ãƒ­ã‚°ã‚¢ã‚¦ãƒˆã—ã¾ã—ãŸ"),console.log("ğŸ”“ ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ"),window.location.href="/"})};function A(e){const t=document.getElementById("login-status"),n=document.getElementById("login-status-text");n.textContent=`${e}ã¨ã—ã¦ãƒ­ã‚°ã‚¤ãƒ³ä¸­`,t.style.display="block"}async function E(){console.log("ğŸ‘¥ é¸æ‰‹ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿é–‹å§‹");const{data:e,error:t}=await f.from("players").select("*").eq("tournament_id",g).order("zekken");if(t){console.error("âŒ é¸æ‰‹èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:",t);return}w=e||[],console.log("âœ… é¸æ‰‹ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿å®Œäº†:",w.length,"äºº"),w.length>0&&console.log("ğŸ“‹ é¸æ‰‹ã‚µãƒ³ãƒ—ãƒ«:",w[0]);const n=document.getElementById("player-select");n.innerHTML='<option value="">é¸æ‰‹ã‚’é¸æŠã—ã¦ãã ã•ã„</option>',w.forEach(l=>{const o=document.createElement("option");o.value=l.zekken,o.textContent=`${l.zekken}ç•ª: ${l.name}${l.club?` (${l.club})`:""}`,n.appendChild(o)})}window.registerCatch=async function(){if(y===0){r("ãƒ­ã‚°ã‚¤ãƒ³ãŒå¿…è¦ã§ã™",!0);return}const e=parseInt(document.getElementById("player-select").value),t=parseFloat(document.getElementById("length-input").value),n=parseFloat(document.getElementById("weight-input").value)||0;if(console.log("ğŸ“ ç™»éŒ²ãƒ‡ãƒ¼ã‚¿:",{zekken:e,length:t,weight:n}),!e){r("é¸æ‰‹ã‚’é¸æŠã—ã¦ãã ã•ã„",!0);return}if(!t||t<=0){r("é•·å¯¸ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„",!0);return}const l=w.find(c=>c.zekken==e),o=l?l.name:`${e}ç•ª`,{error:i}=await f.from("catches").insert({tournament_id:g,zekken:e,length:t,weight:n});if(i){console.error("âŒ ç™»éŒ²ã‚¨ãƒ©ãƒ¼:",i),r("ç™»éŒ²ã«å¤±æ•—ã—ã¾ã—ãŸ",!0);return}console.log("âœ… ç™»éŒ²æˆåŠŸ"),r(`âœ… ${o}: ${t}cm ${n>0?n+"g":""} ã‚’ç™»éŒ²ã—ã¾ã—ãŸï¼`),document.getElementById("player-select").value="",document.getElementById("length-input").value="",document.getElementById("weight-input").value="",await b(),await k()};async function b(){console.log("ğŸ“‹ å±¥æ­´èª­ã¿è¾¼ã¿é–‹å§‹");const e={};w.forEach(o=>{e[o.zekken]=o.name});const{data:t,error:n}=await f.from("catches").select("*").eq("tournament_id",g).order("created_at",{ascending:!1}).limit(50);if(n){console.error("âŒ å±¥æ­´èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:",n);return}L=t||[],console.log("âœ… å±¥æ­´èª­ã¿è¾¼ã¿å®Œäº†:",L.length,"ä»¶");const l=document.getElementById("history-list");if(L.length===0){l.innerHTML='<div class="empty-state">ã¾ã å±¥æ­´ãŒã‚ã‚Šã¾ã›ã‚“</div>';return}l.innerHTML=L.map(o=>{const i=e[o.zekken]||"æœªç™»éŒ²",c=new Date(o.created_at).toLocaleString("ja-JP");return`
            <div class="history-item">
                <div>
                    <strong>${o.zekken}ç•ª: ${i}</strong>
                    <span style="margin-left: 15px; color: #4CAF50;">${o.length}cm</span>
                    ${o.weight>0?`<span style="margin-left: 10px; color: #ccc;">${o.weight}g</span>`:""}
                    <div style="font-size: 12px; color: #aaa; margin-top: 5px;">${c}</div>
                </div>
                ${y===2?`<button class="btn btn-danger" onclick="deleteCatch(${o.id})">å‰Šé™¤</button>`:""}
            </div>
        `}).join("")}window.deleteCatch=async function(e){if(!confirm("ã“ã®è¨˜éŒ²ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ"))return;const{error:t}=await f.from("catches").delete().eq("id",e);if(t){console.error("âŒ å‰Šé™¤ã‚¨ãƒ©ãƒ¼:",t),r("âŒ å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸ",!0);return}r("âœ… å‰Šé™¤ã—ã¾ã—ãŸ"),await b(),await k()};async function k(){console.log("ğŸ† ãƒ©ãƒ³ã‚­ãƒ³ã‚°è¨ˆç®—é–‹å§‹"),console.log("ğŸ“‹ ç¾åœ¨ã®CONFIG:",a),console.log("ğŸ“Š ãƒªãƒŸãƒƒãƒˆåŒ¹æ•°:",a.limit_count),console.log("ğŸ¯ å¤§ä¼šãƒ«ãƒ¼ãƒ«:",a.rule_type);const{data:e,error:t}=await f.from("catches").select("*").eq("tournament_id",g);if(t){console.error("âŒ ãƒ©ãƒ³ã‚­ãƒ³ã‚°èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:",t);return}const n=e||[];if(console.log("ğŸ“Š é‡£æœãƒ‡ãƒ¼ã‚¿:",n.length,"ä»¶"),n.length===0){document.getElementById("ranking-list").innerHTML='<div class="empty-state">ã¾ã é‡£æœãŒã‚ã‚Šã¾ã›ã‚“</div>';return}const l={};w.forEach(s=>{l[s.zekken]=s});const o={};n.forEach(s=>{o[s.zekken]||(o[s.zekken]={zekken:s.zekken,lengths:[],weights:[]}),o[s.zekken].lengths.push(s.length),o[s.zekken].weights.push(s.weight||0)});const i=Object.values(o).map(s=>{const u=[...s.lengths].sort((h,p)=>p-h),T=[...s.weights].sort((h,p)=>p-h),I=a.limit_count||999;console.log(`ğŸ“Š é¸æ‰‹${s.zekken}ç•ªã®è¨ˆç®—:`,{å…¨é‡£æœæ•°:s.lengths.length,ãƒªãƒŸãƒƒãƒˆåŒ¹æ•°:I,å…¨é•·å¯¸:u,ãƒªãƒŸãƒƒãƒˆé•·å¯¸:u.slice(0,I)});const C=T.slice(0,I).reduce((h,p)=>h+p,0),x=u.slice(0,I).reduce((h,p)=>h+p,0);return{zekken:s.zekken,count:s.lengths.length,max_len:Math.max(...s.lengths),max_weight:Math.max(...s.weights),one_max_len:Math.max(...s.lengths),one_max_weight:Math.max(...s.weights),total_weight:s.weights.reduce((h,p)=>h+p,0),total_count:s.lengths.length,limit_weight:C,limit_total_len:x}}),c=a.rule_type||"max_len",m=a.sort1||null,d=a.sort2||null,v=a.sort3||null;i.sort((s,u)=>s[c]!==u[c]?u[c]-s[c]:m&&s[m]!==u[m]?u[m]-s[m]:d&&s[d]!==u[d]?u[d]-s[d]:v&&s[v]!==u[v]?u[v]-s[v]:0),console.log("âœ… ãƒ©ãƒ³ã‚­ãƒ³ã‚°è¨ˆç®—å®Œäº†:",i.length,"äºº");const $=document.getElementById("ranking-list");$.innerHTML=i.map((s,u)=>{const T=u<3,I=l[s.zekken]||{},C=I.name||"æœªç™»éŒ²",x=I.club||"",h=O(c,s[c]),p=m?O(m,s[m]):null,P=d?O(d,s[d]):null;return`
            <div class="ranking-item ${T?"top3":""}">
                <div class="ranking-header">
                    <div style="font-size: 28px; font-weight: bold;">${u+1}ä½</div>
                    <div>
                        <div style="font-size: 24px; font-weight: bold;">${s.zekken}ç•ª: ${C}</div>
                        ${x?`<div style="font-size: 14px; opacity: 0.8;">${x}</div>`:""}
                    </div>
                </div>
                <div class="ranking-stats">
                    <div class="stat">
                        <div class="stat-label">${M[c]}</div>
                        <div class="stat-value" style="color: #FFD700;">${h}</div>
                    </div>
                    ${p?`
                    <div class="stat">
                        <div class="stat-label">${M[m]}</div>
                        <div class="stat-value" style="color: #4CAF50;">${p}</div>
                    </div>
                    `:""}
                    ${P?`
                    <div class="stat">
                        <div class="stat-label">${M[d]}</div>
                        <div class="stat-value" style="color: #2196F3;">${P}</div>
                    </div>
                    `:""}
                </div>
            </div>
        `}).join("")}function O(e,t){return e.includes("len")?`${t.toFixed(1)}cm`:e.includes("weight")?`${Math.round(t)}g`:e==="total_count"?`${t}æš`:t}async function z(){const{data:e,error:t}=await f.from("players").select("*").eq("tournament_id",g).order("zekken");if(t){console.error("é¸æ‰‹ãƒªã‚¹ãƒˆèª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:",t);return}const n=e||[],l=document.getElementById("player-list");if(n.length===0){l.innerHTML='<div class="empty-state">é¸æ‰‹ãŒç™»éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“</div>';return}l.innerHTML=n.map(o=>`
        <div class="player-item">
            <div>
                <strong>${o.zekken}ç•ª:</strong>
                <span style="margin-left: 10px;">${o.name}</span>
                ${o.club?`<span style="color: #aaa; margin-left: 10px;">(${o.club})</span>`:""}
            </div>
            <div>
                <button class="btn btn-primary" style="padding: 8px 15px; font-size: 14px; margin-right: 5px;" onclick="editPlayer(${o.zekken})">ç·¨é›†</button>
                <button class="btn btn-danger" onclick="deletePlayer(${o.zekken})">å‰Šé™¤</button>
            </div>
        </div>
    `).join("")}window.editPlayer=async function(e){const t=w.find(c=>c.zekken===e);if(!t){r("é¸æ‰‹ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“",!0);return}console.log("ğŸ“ ç·¨é›†å‰ã®é¸æ‰‹æƒ…å ±:",t);const n=prompt(`${e}ç•ªã®æ–°ã—ã„åå‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„`,t.name);if(n===null)return;const l=prompt(`${e}ç•ªã®æ–°ã—ã„æ‰€å±ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼ˆç©ºæ¬„å¯ï¼‰`,t.club||"");if(l===null)return;if(!n.trim()){r("åå‰ã¯å¿…é ˆã§ã™",!0);return}console.log("ğŸ“ æ›´æ–°ãƒ‡ãƒ¼ã‚¿:",{name:n.trim(),club:l.trim()}),console.log("ğŸ“ æ›´æ–°æ¡ä»¶:",{tournament_id:g,zekken:e});const{data:o,error:i}=await f.from("players").update({name:n.trim(),club:l.trim()}).eq("tournament_id",g).eq("zekken",e).select();if(i){console.error("âŒ é¸æ‰‹ç·¨é›†ã‚¨ãƒ©ãƒ¼:",i),console.error("âŒ ã‚¨ãƒ©ãƒ¼è©³ç´°:",JSON.stringify(i,null,2)),r(`âŒ ç·¨é›†ã«å¤±æ•—ã—ã¾ã—ãŸ: ${i.message||i.code||"ä¸æ˜ãªã‚¨ãƒ©ãƒ¼"}`,!0);return}if(!o||o.length===0){console.error("âŒ æ›´æ–°å¯¾è±¡ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸ"),r("âŒ æ›´æ–°å¯¾è±¡ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸ",!0);return}console.log("âœ… æ›´æ–°å¾Œã®ãƒ‡ãƒ¼ã‚¿:",o),r("âœ… é¸æ‰‹æƒ…å ±ã‚’æ›´æ–°ã—ã¾ã—ãŸ"),await E(),await z(),console.log("âœ… å†èª­ã¿è¾¼ã¿å¾Œã®ALL_PLAYERS:",w.find(c=>c.zekken===e))};window.addPlayer=async function(){if(y!==2){r("ç®¡ç†è€…æ¨©é™ãŒå¿…è¦ã§ã™",!0);return}const e=parseInt(document.getElementById("new-zekken").value),t=document.getElementById("new-name").value.trim(),n=document.getElementById("new-club").value.trim();if(!e||!t){r("ã‚¼ãƒƒã‚±ãƒ³ç•ªå·ã¨åå‰ã¯å¿…é ˆã§ã™",!0);return}if(w.some(i=>i.zekken===e)){r(`${e}ç•ªã¯æ—¢ã«ç™»éŒ²ã•ã‚Œã¦ã„ã¾ã™`,!0);return}const{error:o}=await f.from("players").insert({tournament_id:g,zekken:e,name:t,club:n||""});if(o){console.error("é¸æ‰‹è¿½åŠ ã‚¨ãƒ©ãƒ¼:",o),r("è¿½åŠ ã«å¤±æ•—ã—ã¾ã—ãŸï¼ˆé‡è¤‡ã®å¯èƒ½æ€§ï¼‰",!0);return}r("âœ… é¸æ‰‹ã‚’è¿½åŠ ã—ã¾ã—ãŸ"),document.getElementById("new-zekken").value="",document.getElementById("new-name").value="",document.getElementById("new-club").value="",document.getElementById("zekken-warning").style.display="none",document.getElementById("add-player-btn").disabled=!1,await E(),await z()};window.deletePlayer=async function(e){if(!confirm(`${e}ç•ªã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ`))return;const{error:t}=await f.from("players").delete().eq("tournament_id",g).eq("zekken",e);if(t){console.error("é¸æ‰‹å‰Šé™¤ã‚¨ãƒ©ãƒ¼:",t),r("âŒ å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸ",!0);return}r("âœ… å‰Šé™¤ã—ã¾ã—ãŸ"),await E(),await z()};const M={limit_total_len:"ãƒªãƒŸãƒƒãƒˆåˆè¨ˆé•·å¯¸",limit_weight:"ãƒªãƒŸãƒƒãƒˆåˆè¨ˆé‡é‡",total_count:"æšæ•°",total_weight:"ç·é‡é‡",one_max_len:"1åŒ¹æœ€å¤§é•·å¯¸",one_max_weight:"1åŒ¹æœ€å¤§é‡é‡"};window.checkZekkenDuplicate=function(e){const t=document.getElementById("zekken-warning"),n=document.getElementById("add-player-btn");if(!e){t.style.display="none",n.disabled=!1;return}const l=parseInt(e);w.some(i=>i.zekken===l)?(t.textContent=`âš ï¸ ${l}ç•ªã¯æ—¢ã«ç™»éŒ²ã•ã‚Œã¦ã„ã¾ã™`,t.style.color="#ff6b6b",t.style.fontWeight="bold",t.style.display="block",n.disabled=!0):(t.textContent=`âœ… ${l}ç•ªã¯åˆ©ç”¨å¯èƒ½ã§ã™`,t.style.color="#4CAF50",t.style.fontWeight="normal",t.style.display="block",n.disabled=!1)};window.updateSortOptions=function(){const e=document.getElementById("rule-type").value,t=document.getElementById("sort1").value,n=document.getElementById("sort2").value,l=[e];t&&l.push(t),n&&l.push(n),S("sort1",l,[e]),S("sort2",l,[e,t]),S("sort3",l,[e,t,n])};function S(e,t,n){const l=document.getElementById(e),o=l.value;l.innerHTML='<option value="">é¸æŠã—ãªã„</option>';const i={one_max_len:"1åŒ¹æœ€å¤§é•·å¯¸",one_max_weight:"1åŒ¹æœ€å¤§é‡é‡",limit_total_len:"ãƒªãƒŸãƒƒãƒˆåˆè¨ˆé•·å¯¸",limit_weight:"ãƒªãƒŸãƒƒãƒˆåˆè¨ˆé‡é‡",total_count:"æšæ•°",total_weight:"ç·é‡é‡"};for(const[c,m]of Object.entries(i))if(!n.includes(c)||c===o){const d=document.createElement("option");d.value=c,d.textContent=m,c===o&&(d.selected=!0),l.appendChild(d)}}async function V(){if(console.log("âš™ï¸ å¤§ä¼šè¨­å®šèª­ã¿è¾¼ã¿é–‹å§‹"),!a||!a.id){console.error("âŒ CONFIG ãŒå­˜åœ¨ã—ã¾ã›ã‚“");return}document.getElementById("rule-type").value=a.rule_type||"limit_total_len",document.getElementById("limit-count").value=a.limit_count||0,updateSortOptions(),document.getElementById("sort1").value=a.sort1||"",document.getElementById("sort2").value=a.sort2||"",document.getElementById("sort3").value=a.sort3||"",updateSortOptions(),console.log("âœ… å¤§ä¼šè¨­å®šèª­ã¿è¾¼ã¿å®Œäº†:",a)}window.updateTournamentSettings=async function(){if(y!==2){r("ç®¡ç†è€…æ¨©é™ãŒå¿…è¦ã§ã™",!0);return}const e=document.getElementById("rule-type").value,t=parseInt(document.getElementById("limit-count").value)||0,n=document.getElementById("sort1").value,l=document.getElementById("sort2").value,o=document.getElementById("sort3").value,i=[n,l,o].filter(u=>u!==""),c=new Set(i);if(i.length!==c.size){r("åˆ¤å®šé †ä½ã§åŒã˜é …ç›®ãŒé¸æŠã•ã‚Œã¦ã„ã¾ã™",!0);return}console.log("ğŸ’¾ è¨­å®šä¿å­˜:",{ruleType:e,limitCount:t,sort1:n,sort2:l,sort3:o}),console.log("ğŸ’¾ æ›´æ–°æ¡ä»¶:",{id:g}),console.log("ğŸ’¾ æ›´æ–°å‰ã®CONFIG.limit_count:",a.limit_count);const{data:m,error:d}=await f.from("tournaments").update({rule_type:e,limit_count:t,sort1:n||null,sort2:l||null,sort3:o||null}).eq("id",g).select();if(console.log("ğŸ’¾ UPDATEçµæœ - data:",m),console.log("ğŸ’¾ UPDATEçµæœ - error:",d),d){console.error("âŒ è¨­å®šä¿å­˜ã‚¨ãƒ©ãƒ¼:",d),console.error("âŒ ã‚¨ãƒ©ãƒ¼è©³ç´°:",JSON.stringify(d,null,2)),console.error("âŒ ã‚¨ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰:",d.code),console.error("âŒ ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸:",d.message),alert(`âŒ è¨­å®šä¿å­˜ã‚¨ãƒ©ãƒ¼: ${d.message}
ã‚³ãƒ¼ãƒ‰: ${d.code}

âš ï¸ Supabase RLS UPDATEæ¨©é™ãŒè¨­å®šã•ã‚Œã¦ã„ãªã„å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚
CRITICAL_FIX.sqlã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚`),r(`âŒ è¨­å®šã®ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ: ${d.message||d.code||"ä¸æ˜ãªã‚¨ãƒ©ãƒ¼"}`,!0);return}if(!m||m.length===0){console.error("âŒ æ›´æ–°å¯¾è±¡ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸ"),r("âŒ æ›´æ–°å¯¾è±¡ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸ",!0);return}console.log("âœ… æ›´æ–°å¾Œã®ãƒ‡ãƒ¼ã‚¿:",m);const{data:v,error:$}=await f.from("tournaments").select("*").eq("id",g).single();if($||!v){console.error("âŒ è¨­å®šå†å–å¾—ã‚¨ãƒ©ãƒ¼:",$),r("âŒ è¨­å®šã®å†å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ",!0);return}a=v,console.log("âœ… å†å–å¾—å¾Œã®CONFIG:",a),r("âœ… è¨­å®šã‚’ä¿å­˜ã—ã¾ã—ãŸ");const s=a.limit_count>0?`ãƒªãƒŸãƒƒãƒˆ${a.limit_count}åŒ¹`:"ç·åŠ›æˆ¦";document.getElementById("tournament-info").textContent=s,await k(),console.log("âœ… è¨­å®šä¿å­˜å®Œäº†")};function r(e,t=!1){const n=document.getElementById("toast");n.textContent=e,n.className="toast"+(t?" error":""),n.style.display="block",setTimeout(()=>{n.style.display="none"},3e3)}let B=null;function J(e,t){B=t,document.getElementById("confirm-message").textContent=e;const n=document.getElementById("confirm-dialog");n.style.display="flex"}window.confirmAction=function(){const e=document.getElementById("confirm-dialog");e.style.display="none",B&&(B(),B=null)};window.cancelConfirm=function(){const e=document.getElementById("confirm-dialog");e.style.display="none",B=null};console.log("âœ… ã‚·ã‚¹ãƒ†ãƒ æº–å‚™å®Œäº†");
